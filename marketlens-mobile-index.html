<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>MarketLens</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/reader.css">

  <!-- Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

<div id="app">
  <div class="app-content">

    <!-- ===== TAB: FEED ===== -->
    <div id="view-feed" class="view active">
      <div class="view-header">
        <img src="assets/logo.png" alt="" style="height:24px;width:auto;">
        <span class="view-header-title" style="text-align:left;">MarketLens</span>
      </div>
      <div class="view-body" id="feed-content">
        <!-- Rendered by JS: job cards, recent activity -->
      </div>
    </div>

    <!-- ===== TAB: LIBRARY ===== -->
    <div id="view-library" class="view">
      <div class="view-header" style="flex-direction:column; align-items:stretch; gap:var(--sp-2);">
        <span class="view-header-title">Library</span>
        <div class="search-bar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" id="library-search" placeholder="Search documents...">
        </div>
      </div>
      <div class="chip-row" id="library-filters">
        <button class="chip active" data-filter="all">All</button>
        <button class="chip" data-filter="starred">‚≠ê Starred</button>
        <button class="chip" data-filter="recent">Recent</button>
      </div>
      <div class="view-body" id="library-content" style="padding:0;">
        <!-- Rendered by JS: document list -->
      </div>
    </div>

    <!-- ===== TAB: RESEARCH ===== -->
    <div id="view-research" class="view">
      <div class="view-header">
        <span class="view-header-title">New Research</span>
      </div>
      <div class="view-body" id="research-content">

        <div class="form-group">
          <label class="form-label">Category</label>
          <div class="chip-row" id="research-categories" style="padding:0;">
            <!-- Rendered by JS -->
          </div>
        </div>

        <div class="form-group" id="framework-group" style="display:none;">
          <label class="form-label">Framework</label>
          <div class="chip-row" id="research-frameworks" style="padding:0;flex-wrap:wrap;">
            <!-- Rendered by JS based on selected category -->
          </div>
        </div>

        <div style="display:flex;gap:var(--sp-3);margin-bottom:var(--sp-4);">
          <div class="form-group" style="flex:1;margin:0;">
            <label class="form-label">Scope</label>
            <div class="toggle-group">
              <button class="toggle-option active" data-scope="asset">Asset</button>
              <button class="toggle-option" data-scope="sector">Sector</button>
              <button class="toggle-option" data-scope="market">Market</button>
            </div>
          </div>
          <div class="form-group" style="flex:1;margin:0;">
            <label class="form-label">Rigor</label>
            <div class="toggle-group">
              <button class="toggle-option" data-rigor="high-level">High Level</button>
              <button class="toggle-option active" data-rigor="in-depth">In-Depth</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">What are you researching?</label>
          <textarea class="form-input" id="research-context" rows="3" placeholder="Describe your research question..."></textarea>
        </div>

        <div class="form-group" id="research-workspace-group">
          <label class="form-label">Add to Workspace</label>
          <button class="btn btn-secondary btn-full" id="research-ws-picker" style="justify-content:flex-start;">
            <span style="color:var(--muted);">None (save to library only)</span>
            <svg style="margin-left:auto;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
        </div>

        <button class="btn btn-primary btn-full" id="research-submit" style="margin-top:var(--sp-4);">
          Generate Research
        </button>

      </div>
    </div>

    <!-- ===== TAB: WORKSPACES ===== -->
    <div id="view-workspaces" class="view">
      <div class="view-header">
        <span class="view-header-title">Workspaces</span>
        <button class="btn-icon" id="ws-create-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
      </div>
      <div class="view-body" id="workspaces-content" style="padding:0;">
        <!-- Rendered by JS: workspace list -->
      </div>
    </div>

    <!-- ===== TAB: SETTINGS ===== -->
    <div id="view-settings" class="view">
      <div class="view-header">
        <span class="view-header-title">Settings</span>
      </div>
      <div class="view-body" id="settings-content">
        <div class="list-item">
          <div class="list-item-content">
            <div class="list-item-title">API Status</div>
            <div class="list-item-subtitle" id="api-status">Not connected</div>
          </div>
        </div>
        <div class="list-item">
          <div class="list-item-content">
            <div class="list-item-title">Profile</div>
          </div>
          <div class="list-item-action">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
        </div>
        <div class="list-item">
          <div class="list-item-content">
            <div class="list-item-title">Support</div>
          </div>
          <div class="list-item-action">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
        </div>
        <div class="list-item" style="color:var(--danger);">
          <div class="list-item-content">
            <div class="list-item-title" style="color:var(--danger);">Log Out</div>
          </div>
        </div>
        <div style="padding:var(--sp-6) var(--sp-4);text-align:center;">
          <p style="font-size:var(--text-xs);color:var(--muted);">MarketLens v2.0 Mobile</p>
        </div>
      </div>
    </div>

  </div><!-- /app-content -->

  <!-- ===== TAB BAR ===== -->
  <nav class="tab-bar" id="tab-bar">
    <button class="tab-bar-item active" data-tab="feed">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>Feed</span>
    </button>
    <button class="tab-bar-item" data-tab="library">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span>Library</span>
    </button>
    <button class="tab-bar-item primary" data-tab="research">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <span>Research</span>
    </button>
    <button class="tab-bar-item" data-tab="workspaces">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
      <span>Workspaces</span>
    </button>
    <button class="tab-bar-item" data-tab="settings">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      <span>More</span>
    </button>
  </nav>

</div><!-- /app -->

<!-- ===== READER (Global Overlay) ===== -->
<div id="reader" class="reader-view">
  <div class="reader-header" id="reader-header">
    <button class="reader-header-back" id="reader-back">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <span class="reader-header-title" id="reader-title">Document</span>
    <button class="reader-header-more" id="reader-more">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
    </button>
  </div>
  <div class="reader-content" id="reader-body">
    <!-- Rendered markdown content -->
  </div>
  <div class="reader-actions">
    <button class="reader-action" id="reader-chat-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      Chat
    </button>
    <button class="reader-action" id="reader-notes-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Notes
    </button>
    <button class="reader-action" id="reader-followup-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      Follow Up
    </button>
    <button class="reader-action" id="reader-toc-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      TOC
    </button>
  </div>
</div>

<!-- ===== TOC Drawer ===== -->
<div id="toc-drawer" class="toc-drawer">
  <div class="toc-backdrop" id="toc-backdrop"></div>
  <div class="toc-panel">
    <div class="toc-heading">Contents</div>
    <div id="toc-list">
      <!-- Rendered by JS -->
    </div>
  </div>
</div>

<!-- ===== Bottom Sheet: Chat ===== -->
<div id="sheet-backdrop" class="sheet-backdrop"></div>

<div id="sheet-chat" class="sheet tall chat-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <span class="sheet-title" id="chat-sheet-title">Chat</span>
    <button class="sheet-close" id="chat-sheet-close">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>
  <div class="sheet-body">
    <div class="chat-messages" id="chat-messages">
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        <p>Ask questions about this document</p>
      </div>
    </div>
    <div class="chat-input-area">
      <textarea class="chat-input" id="chat-input" placeholder="Ask about this document..." rows="1"></textarea>
      <button class="chat-send" id="chat-send">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- ===== Bottom Sheet: Notes ===== -->
<div id="sheet-notes" class="sheet tall">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <span class="sheet-title">Notes</span>
    <button class="sheet-close" onclick="closeSheet()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>
  <div class="sheet-body">
    <textarea class="form-input" id="notes-editor" rows="12" placeholder="Add your notes about this document..."></textarea>
    <button class="btn btn-primary btn-full" id="notes-save" style="margin-top:var(--sp-4);">Save Notes</button>
  </div>
</div>

<!-- ===== Toast Container ===== -->
<div class="toast-container" id="toast-container"></div>

</body>
</html>
